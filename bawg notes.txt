###############################################################################

Format of .txt files

Two newlines in a row (i.e. a blank line) is a paragraph division: <p/>

Info:

{com:[name]} gives the common name for the flower(s) on the page.  If
not specified, it defaults to the page name.

{sci:[name]} gives the scientific name for the flower(s) on the page.
It should always be specified if the common name is different than the
page name.  If not specified, the iNaturalist observation csv file is
searched for the page name (common name) to find the scientific name.

Image links:

{[img].jpg} is replaced with a thumbnail of the image and a link to the
full-size image.

{jpgs} is replaced with all images that start with the page's name.

{[page]:[img].jpg} is replaced with a thumbnail of the image and a link
to the page.

{https://calphotos.berkeley.edu/[...]} is replaced with a blank
thumbnail-sized box that links to the named page.  If the page is
followed by '|[text]', the text is put inside the box.

If a jpg or calphotos link starts a paragraph that has additional
elements in it, all such elements (including free text) is put in a
flexbox and centered vertically with respect to each other.

Page links:

{[com]:[elab]} links to CalFlora with both names.  [com] is optional.
If there is a hyphen prior to [com], the common name and scientific
name are printed on one line.  Otherwise they are printed on two
lines.

{[page]} is replaced with a link to the page.  This does not create a
parent-child page relationship.  If both the common name and
scientific name are known and there is a hyphen prior to the page
name, they are printed on the same line.  Otherwise they are printed
on two lines.

{-[page]} is replaced with a link to the page.  If both the common
name and scientific name are known, they are printed on just one line.

{child:[page]} is replaced with a link to the page.  This also records
a relationship between the parent (the current page) and the child (the
linked page).

{+[page]} is replaced with two links to the page.  The first link is
from a thumbnail of the first flower associated with the page.  The
second link is from the name of the page (common name + scientific name).
A parent-child relationship is also recorded.  If the page is suffixed
with ",[suffix]", that suffix is used for the thumbnail image.

Other:

{-
[list items]
-}
is replaced with proper HTML list syntax, i.e. surrounded by <ul>...</ul>,
with each line also surrounded by <li>...</li>.
A sublist can be included, but must use <ul> and </ul>, each on a line
by itself.

{[
[...]
]}
surrounds the given text with a light-bordered box.

###############################################################################

Make separate pages (and links) for flower lists (by color and "all")
with names only (for bandwidth saving) and photos only (for showing off).

It would be nice to have a glossary with popup links automatically created
  where glossary words are used.
Jepson example:
<u class="dotted" title="Group of bracts more or less held together as a unit, subtending a flower, fruit (acorn cup), or inflorescence." >Involucre</u>
Remember that mobile doesn't support hovering.

Print errors:
  *no color listed
  *listed color not supported
  *broken photo
  no scientific name for leaf page
  multiple scientific names from observations.csv

Read and write back a db.yaml file with various discovered information
about pages that can then be hand edited.  E.g.
  the scientific name used by various sources
  replacement type for 'ssp.' (e.g. 'var.')
  which photo is first for a page
  the common name and scientific name for a page
  alternative common names (e.g. as used in iNaturalist)
  the iNaturalist taxon (if not found in the observations, e.g. for a key)
Should color also go here or separately?
  it might work to generate the db with a new flower, then add the color by hand

The db would obviously override certain discovered info.
  e.g. scientific name from observations.csv
But it should also be overridden by other info
  e.g. scientific name listed on the page.
But when that happens, how should derived info be handled?
  e.g. Jepson scientific name.
Perhaps use an interactive process to initially populate the database,
  and never specify values in other places.
  e.g. if no scientific name is found in observations.csv, ask for it.
  always ask for the color of a new flower
Or mark derived info explicitly in the database,
  e.g. by recording it as "default".
  This allows it to be easily changed or reverted.

It'd be nice if the up/down arrow keys changed which autocomplete entry was currently selected.

It'd be nice the escape key removed autocomplete until more was typed.

Show iNaturalist details on key pages.
  (Requires accumulating data from children.)

###############################################################################

how to mass rename files:
for f in *.jpg; do git mv "$f" "$(echo $f | sed 's/-\([-0-9]*\)\.jpg$/,\1.jpg/')"; done

###############################################################################

Create a script to help copy new and changed files to a portable device.
  Copy new and modified files to a new (and git-ignored) folder,
    ready for the user to copy them over using Windows Explorer.
  Record the timestamp of all files to a (git-ignored) database
    to be used next time for identifying new and modified files.
  Deleted files won't be deleted, but they won't cause any harm.
  Include top-level files that should be copied if they are modified,
    e.g. index.html, bafg.css, search.js, pages.js
  Perhaps allow an argument with a date so that all files modified
    after that date are copied in case the database gets screwed up.
  (Explorer displays the photo creation date, but the file modification
    data is still correct internally.)

Add Calochortus superbus.  Any others?

Add Centaurium tenuiflorum to Zeltnera pages.

What does "wavy toothed" mean for Solanum nigrum?

If a page with photos has N children with photos, it should be counted as
one key and N observed flowers.

If a page with photos has N children without photos, it should be
counted as one key, 1 observed flower, and N-1 unobserved flowers.

Should autogenerated families be structured more like top-level lists
(with a complete indented hierarchy)?

Add link to glossary from top page.

How do I find species that Jepson has in the "CW" region?
Use Calflora's "what grows here" with a genus search?

searching iNaturalist observations using a text name
higher than genus level fails.

Put month info in table format with bar chart.
Put month info side by side with park info (depending on display width?)

/cygdrive/c/Python27/python -m cProfile -s cumtime flowers.py  | less

Put <hr/> before all footer data and remove manual <hr/> from txt files.
Put <hr/> after all header data?  (But don't do two hr's in a row.)

Add (optional) color info for unobserved flowers?
How would that be presented?  (border on CalPhoto placeholder?)

Force a photo placeholder for unobserved children.
Color the placeholder border based on color info.

Allow multiple (labeled) CalPhotos for unobserved flowers.
Also allow CalPhotos for observed flowers; list them after my images.

Create pages using their scientific name whenever possible.
Rename a page when a new scientific name is given.
Links to pages can be by common name or scientific name.
{+...} link is treated the same as {...} link except for jpg check.

mark autogenerated families and unobserved flowers in black in
javascript autocomplete restults.

add California "non-flowering" plants from my photos, e.g. stinging nettle

When multiple self-linked photos (for an observed flower) appear on a
line, allow them to wrap across multiple lines instead of extending
off the screen.  Adjust their "vw" size to be comfortably fit on a
small screen.

Give autocomplete preference to a complete word (second only to a
complete name).

Use non-breaking spaces in footer links (Jepson eFlora) and (Bay Area species).

Sort the glossary word list in reverse alphabetical order so that longer
entries are before shorter entries that start the same.

Update txt format to be line based and require fewer braces.
  manually remove uses of '{child:[page]}' and '{[page]:[photo].jpg}'
    done
  detect any cases of more than one image in repl_photo_box()
    (multiple sets of braces in the imgs variable)
    manually remove those cases
  read bare CalPhotos links from txt file:
    include the image when writing the header images for the page
    restore secondary CalPhotos links for checkerblooms
  write jpg_list automatically without going through self.txt
  detect CalPhotos link followed by child link ({+...}):
    do this after detecting children so that the page is present
    add the CalPhotos link to the child page's txt prior to parsing it
  create photobox when linking:
    remove the CalPhotos link when it is recorded
    in repl_child, return only the link (no photo)
    create nested photobox and image link for a child link
      include the following text in the outer box
    use the child's CalPhotos photo when linking
  -- done --
  modify text prior to *all* parsing, then parse it accordingly:
    {sci:...} -> sci:... (put space after colon or not?)
    {com:...} -> com:...
    {ba|ca|...} -> x:...
    {[ -> [
    ]} -> ]
    {+link} or {link:link} -> +link or +link:link
    {-...-} -> start each line with a period
    add color:... to txt, then parse it from the txt
  ignore blank lines at the start of the file after parsing info
  write out modified txt files:
    write only files that match at least one:
      page was created from txt file (even if txt string is empty after parsing)
      has CalPhotos
      has a color
        (not sure that this is useful for unobserved flowers, but just in case)
        forces output for all observed flowers
          transfers scientific name from observations.csv to txt file
          but do I really want to manually write the family for everything, too?
            nah, but it's only necessary for genuses (at most),
              and I'm willing to rely on observations.csv for it.
    write to txt file:
      com and/or elab if not same as page name (or easily derived)
      color
      completion status
      CalPhotos
      blank line
      modified txt string:
        call parse_names(), _complete(), and _children(), but not _glossary()
        output prior to calling self.parse()
        in repl_child, return the original text
          (e.g. so it includes the scientific name)
          or add the scientific name to the link if it wasn't there before
